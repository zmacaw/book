---
title: app安全测试
---

这一部分主要介绍app安全测试的相关知识和案例。

# APK反编译
1. apktool
   ```
   apktool d testapp.apk
   ```

   ==参考链接：==
   [apktool-doc](https://ibotpeaches.github.io/Apktool/documentation/) -- https://ibotpeaches.github.io/Apktool/documentation/
2. dex2jar
   ```
   sh d2j-dex2jar.sh -f ~/path/to/apk_to_decompile.apk
   ```
3. jd-gui
# Android证书校验

  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  方案               安全风险                                                                                                                                                                                                                             收益
  ------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ------
  不校验                                                                                                                                                                                                                                                  

  系统信任证书校验   走默认的操作系统CA验证                                                                                                                                                                                                               

  公钥校验SSL public APP一旦走了抓包（HTTPS的抓包），将会产生一个临时证书，与内置的公钥摘要不匹配，将会直接报错。很大程度上保证了APP的API请求不被截获篡改。再结合一些混淆服务，让dex文件不可读，API业务对接不做任何验签加密即可用于生产，减少研发投入。   
  key pinning                                                                                                                                                                                                                                             

  证书全内容校验 SSL SSL-PINNING证书到期后会导致APP拒绝服务。                                                                                                                                                                                             
  certificate                                                                                                                                                                                                                                             
  pinning                                                                                                                                                                                                                                                 
  --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# 实现方法--公钥校验

## 流程

1.  提取证书的公钥:

        openssl rsa -in certificate.crt -pubout > public_key.pub

2.  将 public_key.pub 内的 ---begin public key--- 和 ---end
    public key--- 去除，并合并成一行:

        cat public_key.pub | grep -v 'PUBLIC' | awk '{printf("%s",$0)}' 
        # 得到的输出类似
        MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMI...

3.  利用2命令输出的结果，然后 计算sha256摘要 (下载pubkey-sha256.py):

        python pubkey-sha256.py MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMI...
        # 得到的输出类似
        SHA256:S8Ff3JCaO4V...
        # 将开头的 SHA256: 改成 sha256/ ，得到
        sha256/S8Ff3JCaO4V...

将此字符串给到安卓和iOS端，并按照后续文章进行编码
